<div class="container">

  <div class="header">
    <h2>ğŸ‘‘ YÃ¶netici Paneli</h2>

    <div class="actions">
      <button mat-raised-button color="warn" (click)="goVirusLogs()">
           KullanÄ±cÄ± LoglarÄ±
          </button>

      <button class="logout" mat-raised-button color="warn" (click)="logout()">
        <mat-icon>logout</mat-icon> Ã‡Ä±kÄ±ÅŸ Yap
      </button>

      <button mat-raised-button color="primary"
        (click)="openAddUserDialog()"
        [disabled]="!(currentUserLevel === 'SÃ¼per Admin' || currentUserLevel === 'Admin')">
        <mat-icon>person_add</mat-icon> Yeni KullanÄ±cÄ±
      </button>

    </div>
  </div>

  <p *ngIf="message" class="message">{{ message }}</p>
  <table mat-table [dataSource]="users" class="mat-elevation-z2" *ngIf="users.length > 0">

    <!-- KullanÄ±cÄ± AdÄ± -->
    <ng-container matColumnDef="username">
      <th mat-header-cell *matHeaderCellDef>KullanÄ±cÄ±</th>
      <td mat-cell *matCellDef="let user">
        <mat-icon class="user-icon">person</mat-icon>
        {{ user.username }}
      </td>
    </ng-container>

    <!-- Seviye -->
    <ng-container matColumnDef="level">
      <th mat-header-cell *matHeaderCellDef>Seviye</th>
      <td mat-cell *matCellDef="let user">
        <span class="level-badge"
          [ngClass]="{
            'super-admin': user.level === 'SÃ¼per Admin',
            'admin': user.level === 'Admin',
            'user': user.level === 'KullanÄ±cÄ±'
          }">
          {{ user.level }}
        </span>
      </td>
    </ng-container>

    <!-- Dosya SayÄ±sÄ± -->
    <ng-container matColumnDef="total_files">
      <th mat-header-cell *matHeaderCellDef>Dosya SayÄ±sÄ±</th>
      <td mat-cell *matCellDef="let user">{{ user.total_files }}</td>
    </ng-container>

    <!-- Boyut -->
    <ng-container matColumnDef="total_size_mb">
      <th mat-header-cell *matHeaderCellDef>Boyut (MB)</th>
      <td mat-cell *matCellDef="let user">{{ user.total_size_mb }}</td>
    </ng-container>

    <!-- Son YÃ¼kleme -->
    <ng-container matColumnDef="last_upload">
      <th mat-header-cell *matHeaderCellDef>Son YÃ¼kleme</th>
      <td mat-cell *matCellDef="let user">
  {{ user.last_upload | date:'dd.MM.yyyy HH:mm' }}
</td>

    </ng-container>

<!-- ğŸ”¥ KullanÄ±lan Kota -->
<ng-container matColumnDef="used_storage_mb">
  <th mat-header-cell *matHeaderCellDef>KullanÄ±lan (MB)</th>
  <td mat-cell *matCellDef="let user">{{ user.used_storage_mb }}</td>
</ng-container>

<!-- ğŸ”¥ Toplam Kota -->
<ng-container matColumnDef="max_storage_mb">
  <th mat-header-cell *matHeaderCellDef>Toplam (MB)</th>
  <td mat-cell *matCellDef="let user">{{ user.max_storage_mb }}</td>
</ng-container>

<!-- ğŸ”¥ Kalan Kota -->
<ng-container matColumnDef="remaining_mb">
  <th mat-header-cell *matHeaderCellDef>Kalan (MB)</th>
  <td mat-cell *matCellDef="let user">{{ user.remaining_mb }}</td>
</ng-container>

    <!-- Ä°ÅŸlemler -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Ä°ÅŸlemler</th>
      <td mat-cell *matCellDef="let user">

     <button mat-icon-button color="primary"
        (click)="openUserFiles(user)"
        [disabled]="
          user.level === 'SÃ¼per Admin' &&
          currentUserLevel === 'Admin'
        ">
  <mat-icon>folder</mat-icon>
</button>

        <button mat-icon-button color="primary"
        (click)="openQuotaDialog(user)"
        [disabled]="
          user.id === currentUserId ||
          (currentUserLevel === 'Admin' && user.level === 'SÃ¼per Admin')
        ">
  <mat-icon>storage</mat-icon>
</button>
        <button mat-icon-button color="primary"
                (click)="promoteUser(user.id)"
                [disabled]="
                  user.id === currentUserId ||
                  user.level === 'SÃ¼per Admin' ||
                  (currentUserLevel === 'Admin' && user.level !== 'KullanÄ±cÄ±')
                ">
          <mat-icon>arrow_upward</mat-icon>
        </button>

        <button mat-icon-button color="accent"
                (click)="demoteUser(user.id)"
                [disabled]="
                  user.id === currentUserId ||
                  (currentUserLevel === 'Admin' && user.level !== 'Admin') ||
                  user.level === 'KullanÄ±cÄ±'
                ">
          <mat-icon>arrow_downward</mat-icon>
        </button>

        <button mat-icon-button color="warn"
                (click)="deleteUser(user.id)"
                [disabled]="
                  user.id === currentUserId ||
                  (currentUserLevel === 'Admin' && user.level !== 'KullanÄ±cÄ±')
                ">
          <mat-icon>delete</mat-icon>
        </button>

      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

  </table>


  <p *ngIf="users.length === 0" class="empty">HenÃ¼z kayÄ±tlÄ± kullanÄ±cÄ± yok.</p>

</div>
