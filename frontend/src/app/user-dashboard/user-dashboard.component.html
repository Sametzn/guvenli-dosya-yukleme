<div class="container">

  <div class="header">
    <h2>ğŸ“ Dosya YÃ¶netim Paneli</h2>

    <button mat-raised-button color="warn" (click)="logout()">
      <mat-icon>logout</mat-icon> Ã‡Ä±kÄ±ÅŸ Yap
    </button>
  </div>

  <!-- ğŸ“Œ DEPOLAMA KULLANIMI -->
  <mat-card class="quota-card">
    <h3>Depolama KullanÄ±mÄ±</h3>

    <p>
      KullanÄ±lan: {{ quota.used }} MB /
      Toplam: {{ quota.limit }} MB /
      Kalan: {{ quota.remaining }} MB
    </p>

    <mat-progress-bar
      mode="determinate"
      [value]="quota.limit > 0 ? (quota.used / quota.limit) * 100 : 0">
    </mat-progress-bar>
  </mat-card>

  <!-- ğŸ“Œ DOSYA YÃœKLEME -->
  <mat-card class="upload-card">
    <h3>Yeni Dosya YÃ¼kle</h3>

    <input type="file" (change)="onFileSelected($event)">
    <button mat-raised-button color="primary" (click)="upload()">
      <mat-icon>upload</mat-icon> YÃ¼kle
    </button>

    <p class="message">{{ message }}</p>
  </mat-card>

  <!-- ğŸ“Œ ARAMA ALANI -->
  <mat-form-field appearance="outline" class="filter-box">
    <mat-label>Dosya Ara</mat-label>
    <input matInput (keyup)="applyFilter($event)">
  </mat-form-field>

  <!-- ğŸ“Œ TOPLU SÄ°LME BUTONU -->
  <button mat-raised-button color="warn"
          (click)="deleteSelected()"
          [disabled]="selectedFiles.length === 0"
          style="margin-bottom: 10px;">
    <mat-icon>delete</mat-icon> SeÃ§ileni Sil ({{ selectedFiles.length }})
  </button>

  <!-- ğŸ“Œ DOSYA TABLOSU -->
  <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z2">

    <!-- âœ” Checkbox kolon -->
    <ng-container matColumnDef="select">
      <th mat-header-cell *matHeaderCellDef>
        <mat-checkbox (change)="toggleAll($event)"
                      [checked]="isAllSelected()">
        </mat-checkbox>
      </th>
      <td mat-cell *matCellDef="let file">
        <mat-checkbox (change)="toggleSelection(file)"
                      [checked]="isSelected(file)">
        </mat-checkbox>
      </td>
    </ng-container>

    <!-- ğŸ“„ Dosya adÄ± -->
    <ng-container matColumnDef="original_name">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Ad</th>
      <td mat-cell *matCellDef="let file">{{ file.original_name }}</td>
    </ng-container>

    <!-- ğŸ“¦ Boyut -->
    <ng-container matColumnDef="size">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Boyut</th>
      <td mat-cell *matCellDef="let file">{{ file.size }} B</td>
    </ng-container>

    <!-- ğŸ•’ YÃ¼kleme tarihi -->
    <ng-container matColumnDef="uploaded_at">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Tarih</th>
      <td mat-cell *matCellDef="let file">{{ file.uploaded_at }}</td>
    </ng-container>

    <!-- âš™ Ä°ÅŸlemler -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Ä°ÅŸlemler</th>
      <td mat-cell *matCellDef="let file">
        <button mat-icon-button color="primary"
                (click)="download(file.file_id, file.original_name)">
          <mat-icon>download</mat-icon>
        </button>

        <button mat-icon-button color="warn"
                (click)="delete(file.file_id)">
          <mat-icon>delete</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

  </table>

</div>
